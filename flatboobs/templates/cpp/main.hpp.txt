{% import "cpp/utils.txt" as utils %}
/*
 * Generated by FlatBoobs from {{ parser.root_struct_def.file|basename }}
 */

#ifndef {{ output_file|include_guard }}
#define {{ output_file|include_guard }}

#include <cassert>
#include <map>
#include <sstream>
#include <variant>

#include <flatbuffers/flatbuffers.h>
#include <flatboobs/exceptions.hpp>
#include <flatboobs/flatboobs.hpp>

{% for name in parser.included_files.values()|reject("eq", "") %}
#include "{{ name|stem + '_flatboobs.hpp' }}"
{% endfor %}


/*
 * Forvard declaration of structs
 */

{% for group in parser.structs
    | selectattr("file", "equalto", parser.root_struct_def.file)
    | groupby("defined_namespace") %}
{% for component in group.grouper.components %}
namespace {{ component }} {
{% endfor %}

{% for struct_def in group.list|sort(attribute="name") %}
{% set iface_type = "I" + utils.escape(struct_def.name) %}
class {{ iface_type }};
{% endfor %}

{% for component in group.grouper.components|reverse %}
}  // {{ component }}
{% endfor %}
{% endfor %}


{% for group in parser.types
    | map("attr", "definition")
    | selectattr("file", "equalto", parser.root_struct_def.file)
    | groupby("defined_namespace") %}
{% for component in group.grouper.components %}
namespace {{ component }} {
{% endfor %}

/*
 * Declaration of enums
 */

{% for enum_def in group.list|select("instance_of", "EnumDef")
        |sort(attribute="name") %}
{% include "cpp/enum.hpp.txt" %}
{% endfor %}

/*
 * Declaration of structs and tables
 */

{% for struct_def in group.list|select("instance_of", "StructDef")
        |sort(attribute="name") %}
{% set struct_name = utils.escape(struct_def.name) %}
{% set iface_type = "I" + struct_name %}
{% set default_type = "Default" + struct_name %}
{% set mutable_type = struct_name %}
{% set flatbuffer_type = "FlatBuffer" + struct_name %}
{% set unpacked_type = "Unpacked" + struct_name %}
{% set fields = struct_def.fields|rejectattr("attributes.deprecated")|list %}
{% include "cpp/istruct.hpp.txt" %}
{% include "cpp/default_struct.hpp.txt" %}
{% include "cpp/mutable_struct.hpp.txt" %}
{% if not struct_def.fixed %}
{% include "cpp/unpacked_table.hpp.txt" %}
{% include "cpp/pack_unpack.hpp.txt" %}
{% endif %}
{% endfor %}

{% for component in group.grouper.components|reverse %}
}  // {{ component }}
{% endfor %}
{% endfor %}


#endif  // {{ output_file|include_guard }}

{#
// vim: syntax=cpp
// vim: tabstop=2
// vim: shiftwidth=2
#}
